<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Webhook Tester</title>
<style>
  :root{--bg:#0b0c10;--panel:#111316;--muted:#9aa3af;--text:#e5e7eb;--accent:#60a5fa;--border:#1f2937;--radius:14px}
  @media (prefers-color-scheme: light){:root{--bg:#f7f7fb;--panel:#fff;--text:#0f172a;--muted:#6b7280;--border:#e5e7eb}}
  *{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--text);font:16px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial}
  .wrap{max-width:900px;margin:auto;padding:20px}
  h1{font-size:20px;margin:0 0 14px}
  .card{background:var(--panel);border:1px solid var(--border);border-radius:var(--radius);padding:16px;margin-bottom:14px}
  label{display:block;font-size:12px;color:var(--muted);margin:10px 0 6px}
  input,textarea{width:100%;padding:11px;border-radius:12px;border:1px solid var(--border);background:transparent;color:var(--text)}
  textarea{min-height:120px;resize:vertical}
  .row{display:flex;gap:10px} .row>*{flex:1}
  .btn{appearance:none;border:1px solid var(--border);background:transparent;color:var(--text);padding:10px 14px;border-radius:12px;cursor:pointer}
  .btn.primary{background:linear-gradient(135deg,var(--accent),#8b5cf6);border:none;color:#fff}
  .pill{display:inline-block;border:1px solid var(--border);border-radius:999px;padding:6px 10px;font-size:12px;margin-right:8px}
  pre{white-space:pre-wrap;word-break:break-word;border:1px solid var(--border);border-radius:12px;padding:10px;background:#0f172a;color:#e2e8f0}
  .small{font-size:12px;color:var(--muted)}
</style>
</head>
<body>
<div class="wrap">
  <h1>Webhook Tester</h1>

  <div class="card">
    <div>
      <label for="endpoint">Endpoint URL</label>
      <input id="endpoint" value="https://webhook.site/efcf00a8-841c-4a52-99fa-5acecda707a7" />
      <div class="small">Sends a <strong>POST</strong> as <code>application/x-www-form-urlencoded</code> (simple request, no CORS preflight).</div>
    </div>

    <div class="row" style="margin-top:10px">
      <div>
        <label for="name">Name</label>
        <input id="name" placeholder="Jane Doe" />
      </div>
      <div>
        <label for="email">Email</label>
        <input id="email" type="email" placeholder="jane@example.com" />
      </div>
    </div>

    <div style="margin-top:10px">
      <label for="body">Additional fields (JSON, optional)</label>
      <textarea id="body" placeholder='{"note":"extra fields you want to include"}'></textarea>
      <div class="small">
        Extra JSON is merged into individual form fields so they appear in webhook.site’s <strong>Form</strong> tab.
      </div>
    </div>

    <div class="row" style="margin-top:10px">
      <button class="btn primary" id="send">Send</button>
      <button class="btn" id="copyCurl">Copy cURL</button>
      <button class="btn" id="clear">Clear</button>
    </div>
  </div>

  <div class="card">
    <div style="margin-bottom:8px">
      <span class="pill">Status: <strong id="status">—</strong></span>
      <span class="pill">Time: <strong id="time">—</strong></span>
      <span class="pill">Size: <strong id="size">—</strong></span>
    </div>
    <label>Response Headers</label>
    <pre id="respHeaders">—</pre>
    <label>Response Body</label>
    <pre id="respBody">—</pre>
  </div>

  <p class="small">Tip: open the webhook URL in another tab to watch your requests arrive in real time.</p>
</div>

<script>
  const $ = (id) => document.getElementById(id);

  function parseJSONSafe(txt, fallback) {
    if (!txt?.trim()) return fallback;
    try { return JSON.parse(txt); } catch { return fallback; }
  }

  // Build x-www-form-urlencoded body
  function toFormUrlEncoded(obj) {
    const p = new URLSearchParams();
    Object.entries(obj || {}).forEach(([k, v]) => {
      if (v !== undefined && v !== null) p.append(k, String(v));
    });
    return p.toString();
  }

  function buildCurlForm(url, obj) {
    const params = new URLSearchParams();
    Object.entries(obj || {}).forEach(([k,v]) => params.append(k, String(v)));
    const data = params.toString().replace(/'/g, `'\\''`);
    return [
      'curl','-X','POST', `'${url}'`,
      '-H','\'Content-Type: application/x-www-form-urlencoded\'',
      '--data', `'${data}'`
    ].join(' ');
  }

  $('send').addEventListener('click', async () => {
    const url    = $('endpoint').value.trim();
    const name   = $('name').value.trim();
    const email  = $('email').value.trim();
    if (!url) { alert('Please provide the endpoint URL'); return; }

    // Optional extras (JSON) → merged as individual form fields
    const extra = parseJSONSafe($('body').value, {});
    const payload = { name, email, ...extra };

    // Simple request: x-www-form-urlencoded body; DO NOT set custom headers to avoid CORS preflight
    const bodyStr = toFormUrlEncoded(payload);

    const t0 = performance.now();
    let resp, ok=false, text='', size=0;
    try {
      resp = await fetch(url, {
        method: 'POST',  // force POST to stay a "simple request"
        body: bodyStr    // browser sets Content-Type: application/x-www-form-urlencoded;charset=UTF-8
      });
      ok = resp.ok;
      const buf = await resp.arrayBuffer(); size = buf.byteLength;
      text = new TextDecoder().decode(buf);
    } catch (e) { text = String(e); }
    const ms = Math.round(performance.now() - t0);

    $('status').textContent = resp ? `${resp.status} ${resp.statusText}` : 'NETWORK ERROR';
    $('time').textContent = `${ms} ms`;
    $('size').textContent = `${size}`;
    const hdrs = [];
    if (resp) resp.headers.forEach((v,k)=> hdrs.push(`${k}: ${v}`));
    $('respHeaders').textContent = hdrs.join('\n') || '—';
    $('respBody').textContent = text || '—';
  });

  $('copyCurl').addEventListener('click', () => {
    const url    = $('endpoint').value.trim() || 'https://webhook.site/efcf00a8-841c-4a52-99fa-5acecda707a7';
    const name   = $('name').value.trim();
    const email  = $('email').value.trim();
    const extra  = parseJSONSafe($('body').value, {});
    const payload = { name, email, ...extra };
    const curl = buildCurlForm(url, payload);
    navigator.clipboard.writeText(curl).then(()=> alert('cURL copied to clipboard'));
  });

  $('clear').addEventListener('click', () => {
    $('name').value = '';
    $('email').value = '';
    $('body').value = '';
    $('status').textContent = '—';
    $('time').textContent = '—';
    $('size').textContent = '—';
    $('respHeaders').textContent = '—';
    $('respBody').textContent = '—';
  });
</script>
</body>
</html>
